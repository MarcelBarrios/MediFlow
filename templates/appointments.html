{% extends 'base.html' %}

{% block title %}Appointments{% endblock %}

{% block content %}


<h1 class="text-2xl font-bold mb-4 flex justify-center mt-2">Appointments</h1>
<div class="mt-10 px-4 md:px-10">
    <!-- Appointments Table -->
    <table class="w-full table-auto border-collapse border border-gray-400 shadow-xl rounded-lg overflow-hidden">
        <colgroup>
            <col style="width: 12%;"> <col style="width: 10%;"> <col style="width: 15%;"> <col style="width: 8%;"> <col style="width: 10%;"> <col style="width: 45%;"> </colgroup>
        <!-- Table Header -->
        <thead class="bg-blue-700 text-white">
            <tr>
                <th class="border border-gray-400 px-4 py-2 text-center">
                    <div class="flex items-center justify-center space-x-1">
                        <span>Date/Time</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </th>
                
                <th class="border border-gray-400 px-4 py-2 text-center">
                    <div class="flex items-center justify-center space-x-1">
                        <span>MRN</span>
                    </div>
                </th>

                <th class="border border-gray-400 px-4 py-2 text-center">
                    <div class="flex items-center justify-center space-x-1">
                        <span>Patient Name</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </th>

                <th class="border border-gray-400 px-4 py-2 text-center">Age</th>
                <th class="border border-gray-400 px-4 py-2 text-center">Checked In</th>
                <th class="border border-gray-400 px-4 py-2 text-center">Chief Complaint</th>
            </tr>
        </thead>
        <!-- Table Body -->
        <tbody class="[&>tr:nth-child(even)]:bg-gray-200">
            {% for appointment in appointments %}
            <tr>
                <td class="border border-gray-400 px-4 py-2">
                    <div class="flex items-center justify-between">
                        <span>{{ appointment.get('date_time', 'N/A') }}</span>
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 text-gray-500 hover:text-blue-500 cursor-pointer" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <title>Edit</title>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15.828 10 16.5V16l-.707-.707 1.414-1.414z" />
                        </svg>
                    </div>
                </td>
                <!-- MRN -->
                <td class="border border-gray-400 px-4 py-2">{{ appointment.get('mrn', 'N/A') }}</td>
                <!-- Patient name links to intake form -->
                <td class="border border-gray-400 px-4 py-2">
                    <a href="{{ url_for('patient_intake.patient_intake', mrn=appointment.get('mrn', '')) }}"
                        class="text-blue-600 hover:underline">{{ appointment.get('patient_name', 'N/A') }}</a>
                </td>
                <!-- Age -->
                <td class="border border-gray-400 px-4 py-2 text-center">{{ appointment.get('age', 'N/A') }}</td>
                <!-- Check In logic: ✅ if already checked in, otherwise show button -->
                <td class="border border-gray-400 px-4 py-2 text-center">
                    {% if appointment.get('checked_in') %}
                        ✅
                    {% else %}
                        <form method="POST" action="{{ url_for('appointments.check_in_appointment', appointment_id=appointment['_id']) }}">
                            <button type="submit" class="text-black border border-black bg-white px-2 py-1 rounded hover:bg-gray-100">
                                Check In
                            </button>
                        </form>
                    {% endif %}
                </td>    
                <!-- Chief Complaint -->                  
                <td class="border border-gray-400 px-4 py-2 whitespace-normal break-words">{{ appointment.get('chief_complaint', 'N/A') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}